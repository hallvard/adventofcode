package hallvard.adventofcode.day6;

public class Part1 {

    enum Direction {
        UP(0, -1),
        RIGHT(1, 0),
        DOWN(0, 1),
        LEFT(-1, 0);

        final int dx;
        final int dy;

        private Direction(int dx, int dy) {
            this.dx = dx;
            this.dy = dy;
        }
        
        static Direction of(char c) {
            return switch (c) {
                case '^' -> UP;
                case '<' -> LEFT;
                case 'v' -> DOWN;
                case '>' -> RIGHT;
                default -> null;
            };
        }

        Direction turn() {
            return switch (this) {
                case UP -> RIGHT;
                case LEFT -> UP;
                case DOWN -> LEFT;
                case RIGHT -> DOWN;
            };
        }
    }

    record Location(int x, int y) {
        Location step(Direction direction) {
            return new Location(x + direction.dx, y + direction.dy);
        }
    }

    public int compute(String input) {
        String[] lines = input.split("\n");
        char[][] grid = new char[lines.length][];
        Location location = null;
        Direction direction = null;
        for (int row = 0; row < lines.length; row++) {
            char[] cs = lines[row].toCharArray();
            grid[row] = cs;
            if (direction == null) {
                for (int col = 0; col < cs.length; col++) {
                    direction = Direction.of(cs[col]);
                    if (direction != null) {
                        location = new Location(col, row);
                        break;
                    }
                }
            }
        }
        int count = 0;
        while (true) {
            if (grid[location.y][location.x] != 'X') {
                count++;
            }
            grid[location.y][location.x] = 'X';
            if (location.x + direction.dx < 0
                || location.x + direction.dx >= grid[0].length
                || location.y + direction.dy < 0
                || location.y + direction.dy >= grid.length) {
                break;
            }
            char c = grid[location.y + direction.dy][location.x + direction.dx];
            if (c == '#') {
                direction = direction.turn();
            }
            location = location.step(direction);
        }
        return count;
    }

    public static void main(String[] args) {
        System.out.println(new Part1().compute(INPUT));
    }

    public final static String INPUT = """
        .........................#...........#.#...#...............#..............##.....................#...........#..#.........#.......
        .....................#.................#.......#.........................#...........#.#.......#..................................
        .........#...........#........#.........#.........#...........#........................................#.........................#
        .......#.........................#...........................#.............#......................................................
        ..................#................##...............#.#.....................##............#.......................................
        ......#...#................#..................................................................#....#.#............................
        .......##................#........#..#.......#......................................#........#............#......###..........#...
        .....................#....................................................#...........#..#...#..........................#.........
        ...........#....#...........................#.#...............#..#....................................#..............#......#.....
        .....#........##...............#.......#..#..............................................#..........................#.............
        .#.........#.#...........................#..........................#......................#...........#........#.................
        .................................................................#..#.#.......#..#................................................
        ...............................................#.......#...................#....................#.................................
        .......#......#......#......................#...............................#.....##........#...........#......#..................
        ........................................................................................................#.....#.#.................
        ..#...............................#.#..................................#.............#............................................
        ..............#..........................................#.....#.....#..........................#....#.........#..................
        ...................................#........................................#................#...........##.....#....#............
        .#.....................................#.......#........................#...................##............#.......................
        .#..................#...........#...........................................................................................#.....
        ........................#...................................................##.................................#..#..........##...
        ........#............................#.......#...........................#.#...#...................................#.....#........
        ...............................#............#.....#......................#.......#...#........................#...................
        .........#.............#.................................................#.......................................#....#...........
        ...................................................................#...#.................................#...................#....
        ...#.....................#...#...............#..................................................#...#...#.........................
        ...................#........#....#....#..#..#...................#.........#..................#..#....#.......#.#.................#
        ..............................#........................................#......#.....#..............##................#............
        ............#..#.............#.......#........................................................##........#.....#...................
        .....#.............................................................#...#.#.#.............................#..#.#...........#.......
        .......#....#............................................#.................................#...................................#..
        ..#.................#.......#..........................#........................................#...............#..............#..
        ....#.#...................#............................#..#.......................................................................
        .......................#...............#..............#......#......................#.....................#..............#........
        .#..........#.......................................................................#....................................#........
        .#.......#..................................................................#.....................................................
        ..................................................#.............#.............................................#................#.#
        .......................#......#....#................#......................................................#.......#.........#....
        ..........................#.#........................................................#......#................................#....
        ....................................................................#...............................#.............................
        ..#...........#..............................#..#....#............................#...............##..............#...#...#...#..#
        ...................................#................................................................#....#...................#....
        ..#....#........#..##....#........................#...#...................................#.......................................
        ...................#................................................................................................#.............
        .......#........#................#...#.......................................................................#....................
        ..............#....................#..........................##.........#.....................................#..................
        .........................................................................#.................#........................#.............
        .............................#..........#.......................................................#......................#..........
        ............###....................................................................#.......................#......................
        ........#........#...........#.............................#....................#..........#.........................#.#.....#....
        .........................................................................................................#..#.....................
        #.#.....#..........................................................#.....................#........................................
        ........##..........#....................................................#..#........#.......#........#................#..........
        .............................................#..........................#.........#........................#......................
        ...........................##.............#........................#.#........................#..#................#.....#........#
        #...#..............................................#........#...................................................#.................
        .............#................#............................#............#.........................................................
        #..........................#............#.....................#.....#.................#......#...##...#.............#.#...........
        .....................#...#..#....#...................................#....................#..............#........#...............
        .......................#.................#...........#....#.......#...........................................#..#................
        .........#...........#.#.........#.........................#.....#................................................................
        ....................#........#...................................................................#............#..#.#.#............
        ..........#.......................#.......................#.......................................................................
        ......................................#......#............................#..............................................#........
        .....................#...#.................#.............................#....#...................................................
        ..............##...................................................................#......................................##......
        .....#....#...............................................#.......#.##........#.#.............#...............#...................
        ....................................#......................#........#.......................................................#.....
        .....#.........................................#.....................#.............#.................#..................#.........
        ................................#.........#..#............................................#.........................#.............
        ....#.#.....................#......#...................................#..........................................#..#.....#...#..
        .........##.......................#..........................................#.........................#...##.....................
        ...............................................................#................................................................#.
        ............#.........................................##.......................................#..................................
        .............................#..............................#..................#.........#.....#..................................
        ..........................................................#...#.....#..................#................................#.........
        ......#...................#.........................................................................................#.............
        #...............................#...........................#.....................................................................
        .......#........#.................................................#.......................................................#.......
        .#......................................................#..............#..................................#...........#...........
        .............#..#.#.......................#..........#......#.##.........................................................#..#.....
        .......#...............#........#......................................................................#..#...........#...........
        ............#.........................................#................................................#...................#......
        ............#...........................................#.#.......#....................................#..........................
        ...........................................#.........................................................#..............#.............
        ..................#..#....................................................#..................#....................................
        ..#........................#........#.............................................................................................
        .............#........#......................#.......................................#...#....#............................#......
        ............#.......#.............#...#...........#.#.................................#.................##........................
        .....................................................................................#.........#.......................#.....#....
        .................#................................#..#....#......#..........................................#.....#...............
        ..#...............................#........................................................#.......#...#............#.............
        #.........#..#..#.....................................#....................................#................#.................#...
        .......................#..#...#............................................................................#..#.....#.......##....
        ..........#............#.......................#.........................^......#.#...................................#...........
        ...##........................##..........#..........#.................#...............#...........#.....##........................
        ..............#............#..........................#....#...........#......#......#......................#.....................
        ......#.....#....................................................#............#.#......................................#..........
        ......#.............................#......................#...............................#........#.............................
        .#..........#.............................................#.............................................#.........................
        ...............................##.................................................................................................
        .....................#................................................#...............#............#...............#.....#.....#..
        ..................#...........................................................................#...........#...................#...
        ##..............................#.#...#.#...............................#...........#.#...................#.......................
        ......................#.........#...................................#.................#...........................................
        .......................#............................................................................#.........##...........#......
        .....................................................................#.......#.....#.......................................#......
        #....................................#........#.#.................................................................##.....#........
        ..............#..............................#......#..........###.........#................#..............#..................#...
        ..................................#..............................#.................##.............................#...#...........
        ...............#......#........................#....#........#............#.........#..........#..............#......#............
        ...#...........#........#...#...........................#.............#.....................................#.....................
        ..............###............#...........................................................#.............#.........##..#............
        ............#................................................#.......#..................#....#....................................
        .........#.#...#.....#...........................#.....##......#.....................#..#........#......#.........................
        .#....#.......#.......................#.................................................................#.......#..............#..
        ...................#................................................................#.............#...#...........#.........#.....
        .......#.#.......#.......................#....#.....#...............#...#.....#...........................................#.......
        .......#........#...........................................#...........#.........................#....#.......#..................
        ..................................#.#.................#.#............................................#...........#....#...........
        ....##......#.............#...................................#...#.........#...........................#......#..................
        .........................#......#....#...#........................................................................................
        ...#...............#............................................................................#...........................#.....
        ....##.#..............................................#............#................#................................#......#.....
        .........#...........................................#...#.......##..............................#................................
        ..................#..........#......#.......#......................................#........#...............#......#...........##.
        ........................................#......#..........#......................................................................#
        ..............#...#...................#.....#..........................................................#..............#......#....
        ...#........#........................#...#................#........#.............................##..........................#....
        ............#............................#.#........................#.................................#..........................#
        """;
}