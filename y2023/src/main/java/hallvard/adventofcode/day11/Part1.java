package hallvard.adventofcode.day11;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

public class Part1 {

    static class Location {
        long x, y;
        Location(long x, long y) {
            this.x = x;
            this.y = y;
        }
        @Override
        public String toString() {
            return "(" + x + "," + y + ")";
        }
    }

    void toDisplacements(List<Long> nonEmptyIndices, long expansion) {
        long totalExpansion = 0;
        for (int pos = 0; pos < nonEmptyIndices.size(); pos++) {
            long index = nonEmptyIndices.get(pos);
            while (pos < index) {
                nonEmptyIndices.add(pos, totalExpansion);
                totalExpansion += expansion;
                pos++;
            }
            nonEmptyIndices.set(pos, totalExpansion);
        }
    }

    List<Location> parseUniverse(String input, int expansion) {
        List<Location> galaxies = new ArrayList<>();
        String[] lines = input.split("\n");
        List<Long> nonEmptyRows = new ArrayList<>(), nonEmptyColumns = new ArrayList<>();
        for (int row = 0; row < lines.length; row++) {
            String line = lines[row];
            for (int col = 0; col < line.length(); col++) {
                var symbol = line.charAt((int) col);
                if (symbol == '#') {
                    galaxies.add(new Location(col, row));
                    if (! nonEmptyRows.contains((long) row)) {
                        nonEmptyRows.add((long) row);
                    }
                    if (! nonEmptyColumns.contains((long) col)) {
                        nonEmptyColumns.add((long) col);
                    }
                }
            }
        }
        toDisplacements(nonEmptyRows, expansion - 1);
        Collections.sort(nonEmptyColumns);
        toDisplacements(nonEmptyColumns, expansion - 1);

        for (Location galaxy : galaxies) {
            galaxy.y += nonEmptyRows.get((int) galaxy.y);
            galaxy.x += nonEmptyColumns.get((int) galaxy.x);
        }

        return galaxies;
    }

    public long compute(String input, int expansion) {
        List<Location> galaxies = parseUniverse(input, expansion);
        long sum = 0;
        for (int pos1 = 0; pos1 < galaxies.size(); pos1++) {
            Location galaxy1 = galaxies.get(pos1);
            for (int pos2 = pos1 + 1; pos2 < galaxies.size(); pos2++) {
                Location galaxy2 = galaxies.get(pos2);
                long distance = Math.abs(galaxy1.x - galaxy2.x) + Math.abs(galaxy1.y - galaxy2.y);
                sum += distance;
            }
        }
        return sum;
    }

    public static void main(String[] args) {
        System.out.println(new Part1().compute(INPUT, 2));
    }

    public final static String INPUT = """
        .........................#...........................................................................................................#......
        ..................#................................................#........................#................#..............................
        ...........................................................................#........................#...........................#...........
        ........#...................#........#......#.............#.....................#...........................................................
        ..........................................................................................................#........#........................
        .....................#..........................#..........................................................................#................
        .#...........#................................................................................................#....................#......#.
        ...............................#..........................................#..........#......................................................
        ....................................#............................#...................................#......................................
        .................#.......................................................................................................#..................
        .........................#.....................#.......................#........#.....................................................#.....
        .....#...............................................#......................................#...............................................
        ..............................#..................................................................#.............#............................
        #....................................#..................................................................#...................................
        ..........................................................#.................................................................................
        ......................................................................#...........................................#.........................
        ............#...............................................................#............................................#.............#....
        ....#.........................................................................................................................#.............
        ...................................#.....#.................................................................................................#
        ................................................#........................#.........#..........................#.............................
        ..........................#....................................#................................#...........................................
        ......#..............#...........................................................................................................#..........
        .................................#.......................#............................#................#....................................
        ..................................................#..................#.....#................................................................
        ............#..............................#.................................................#............................#.................
        ..................#...............................................................#........................#.....#....................#.....
        .....#......................................................................................................................................
        ..............................................#............#.........................................#...............#......................
        ..................................................................#.........................................................................
        ............................#..............................................................................................#.............#..
        ......................#..........................................................................................................#..........
        .......................................................................................#....................................................
        .............................................#...............................#.............................#..........................#.....
        .#................#.........................................................................................................................
        ................................#...................................................#..........................#............................
        ..........#..............#........................................#................................#.....................................#..
        ...............................................#.......#..................................#.................................................
        ............................................................#...................................................................#...........
        ....................#.....................#................................................................................#................
        ............................#.....................#............................................#............................................
        .............#................................................................................................#.............................
        .................................................................#......................#...............#...................................
        .......................................................................#.........#..................................#.......................
        ......#.......................#........................#....................................................................................
        ...................#..................................................................................................................#.....
        ......................................#..............................................................#...................#..................
        .#............................................#................#.............#.................#................#.............#.............
        ............................................................................................................................................
        ..................................................................................#..................................#......................
        .......#..............#............................................#......#...............................#.............................#...
        ..................................#..............#..........................................................................................
        ..............#..........................................#..................................................................................
        ...............................................................#................................................#.................#.........
        .........................#...................................................#.........................................#....................
        ............................................................................................................................................
        ...#..............#................................................................................#.......................#................
        .....................................................#.................................#......#.............................................
        .................................#.......................................#......#..................................#........................
        ............................................................................................................................................
        ............................................................................................................................................
        ....................................#............#...........................#.........................#....................#...............
        ......#................#.........................................................................#.........................................#
        ........................................#..................#................................................................................
        .................#......................................................................#....................#.....#.................#......
        .....................................................................................................#......................................
        .#.......................................................................................................................#...............#..
        ..............................#.................#...........................................................................................
        .......#...............#...................#.........................................#.....................#.....#..........................
        ...................................#...........................................................#............................................
        ..................#................................................#............#...........................................#......#........
        ............................................................................................................................................
        .......................................................................................................................#....................
        .............................#.....................#...........................................................#...........................#
        ...............#....................#.............................................................#.........................................
        .....#..............#..................................................................................#....................................
        #..............................................#...........................#................................................#...........#...
        ..................................................................#.............#..........#.......................................#........
        ............................................................................................................................................
        .........#......#..........#........................#............................................................#..........................
        ........................................................................................#..........#........................................
        ........................................#...................#........#....................................#............#....................
        ..............................#..................................................#..........................................................
        ............................................#.........................................................#.....................................
        .....#........#...........#..........................................................#......................................#...............
        ................................................#........................#.................................................................#
        .....................................#.....................#..................................................#.................#.....#.....
        .#.......#.........................................................#................................#.......................................
        ............................................................................................................................................
        ...............................#...........#................................................................................................
        .................................................................................................#..........#.....#.........................
        ......#...........#........#.......................#..............................#.................................................#.......
        .........................................................................#..................................................................
        ...........#..................................#........................................................................#.....#..............
        .......................................#......................................................................#.............................
        #.....................#.........................................................................#........................................#..
        .................................................................................#...................#......................................
        .................................................#..............#...........#......................................................#........
        ................#............#.....#........................................................................................................
        .....#......................................#...............................................................................................
        .......................................................#.....#.........................#.........#...................#......................
        ................................#....................................................................................................#......
        .....................#.........................................................................................#............................
        ............#.......................................#...............#..........#....................#.......................................
        .........................................................................................#..................................................
        ................................................#..............................................#.......................................#....
        ...#......................#...............................................................................................#......#..........
        ...........................................................#.................#.......#......................................................
        ..........................................................................................................#...........#.....................
        ......................................#........................#.....#.......................#................................#......#......
        ...................#..............................................................................#.........................................
        .#..........................................................................................................................................
        .......................#......#...........................................#.........#...........................#..........#................
        .............#...................................#....................................................#...................................#.
        ...................................#........#...............................................................................................
        ................................................................................................#...................#.......................
        .................................................................................................................................#..........
        .....................#......................................#................#.......#......................................................
        #......#..................#..............................................................................#..............#...................
        ...........................................#.....................................................................#..........................
        .............#......................#...........#......................................................................................#....
        ...................#.....................................#............#.....................................................................
        .......................................................................................#.........#.....#.............#......................
        ...........................................................................#....................................................#...........
        ..................................#.............................#..............................................#............................
        ...............#..........#......................#..................................#.......................................#...............
        ........................................#...................................................................................................
        ...........................................................................................#............#...................................
        .............................#...............................................#........................................................#.....
        .............#................................#......#.........#......#............................#............#...........................
        ...#.....................................................................................................................#..................
        .........................................................#...........................#.....................................................#
        ........#........................................#..................................................................#..............#........
        #..........................#......#.....#................................................#..................................................
        ............................................................................................................................................
        ....................................................#........#.................................#.......................#....................
        .................#..........................................................................................................................
        .......................#....................#........................#.....................#...........#..........#.........................
        .....#..............................#.......................................................................#................#............#.
        ..........................................................#...............#.................................................................
        ...........#.......#.....................#...........#.........#.................#.................#........................................
        """;
}